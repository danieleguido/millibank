{% extends "walt/middle.html" %}
{% load i18n %}
{% load extras %}
{% block spiffing %}{% if spiff %} {{ spiff }}'s {% endif %}{% endblock %}


{% block urls %}
	{{ block.super }}
	{% if user.is_authenticated %}
	oo.urls.get_serie = "{% url glue_api_serie_frames 0 %}";
	oo.urls.list_serie = "{% url glue_api_series %}";
	oo.urls.remove_serie = "{% url glue_api_serie 0 %}";
	oo.urls.add_serie = "{% url glue_api_series %}";
    oo.urls.edit_serie = "{% url glue_api_serie 0 %}";


	oo.urls.get_pin = "{% url glue_api_pin 0 %}";
	oo.urls.list_pin = "{% url glue_api_pins %}";
	oo.urls.edit_pin = "{% url glue_api_pin 0 %}";

	{% endif %}
{% endblock %}

{% block navbar %}
	<div class="grid_12" >
				
		<h2 class="grid_3 alpha">
			<a href="{% if spiff %}{% url walt_w_spiff spiff %}{% else %}{% url walt_w %}{% endif %}">{% if spiff %} his/her {% endif %} {{ walt.wander.page.title }}
				( {{ walt.wander.pins.count }} )
			</a>
			{% if user.is_authenticated %}
				<a href="#add-walt-w-modal" role="button" data-toggle="modal" style="color: crimson">+ {% trans "add bookmark" %}</a>
			{% endif %}
			<div class="description">
				
			
				{{ walt.wander.page.abstract }}
			</div>
		</h2>
		<h2 class="grid_3">
			<a href="{% if spiff %}{% url walt_a_spiff spiff %}{% else %}{% url walt_a %}{% endif %}">{% if spiff %} his/her {% endif %}  {{ walt.augment.page.title }}
				( {{ walt.augment.pins.count }} )
			</a>
			{% if user.is_authenticated %}
				<a href="#add-walt-a-modal" role="button" data-toggle="modal" style="color: crimson">+ {% trans "add object" %}</a>
			{% endif %}
			<div class="description">
				{{ walt.augment.page.abstract }} 
			</div>
		</h2>
		<h2 class="grid_3" >
			<a href="{% if spiff %}{% url walt_l_spiff spiff %}{% else %}{% url walt_l %}{% endif %}">{% if spiff %} his/her {% endif %}  {{ walt.learn.page.title }}
				 ( {{ walt.learn.pins.count }} )
			</a>
			{% if user.is_authenticated %}
				<a href="#add-walt-l-modal" role="button" data-toggle="modal" style="color: crimson">+ {% trans "add publication" %}</a>
			{% endif %}
			<div class="description">
				{{ walt.learn.page.abstract }}
			</div>
		</h2>
		<h2 class="grid_3 omega">
			<a href="{% if spiff %}{% url walt_t_spiff spiff %}{% else %}{% url walt_t %}{% endif %}">{% if spiff %} his/her {% endif %}  {{ walt.try.page.title }}
				( {{ walt.try.pins.count }} )
			</a>
			{% if user.is_authenticated %}
				<a href="#add-walt-t-modal" role="button" data-toggle="modal" style="color: crimson">+ {% trans "add tool" %}</a>
			{% endif %}
			<div class="description">
				{{ walt.try.page.abstract }}
			</div>
		</h2>
	</div>

	<div class="grid_12 shadow" >
		<div class="grid_3 alpha">&nbsp;</div>
		<div class="grid_3">&nbsp;</div>
		<div class="grid_3">&nbsp;</div>
		<div class="grid_3 omega">&nbsp;</div>
	</div>
{% endblock %}


{% block footer %}
	{% if user.is_authenticated %}
		<div class="grid_2 alpha">
			<h2><a href="#add-serie-modal" data-toggle="modal" role="button">{% trans "start a new serie" %}</a>
			</h2>
		</div>
			
		{% if workon_serie %}
			<div class="grid_10 omega">
				<!-- last serie aka workon, if any -->
				{% for serie in workon_serie %}
				<h2>
				
					<a href="{% url walt_serie serie.slug %}">{{ serie.title }}</a> ( {{ serie.type }} ) {% trans "frames" %} : {{ serie.frames.count }}
				
				</h2>
				
				<!-- serie authors 
				<p class="authors">{% trans "created by" %}
							{% for u in serie.authors.all %}
								<a href="{% url walt_spiff u.username %}">{{ u.username }}</a>
								{% if not forloop.last %}, {% endif %}

							{% endfor %}
				</p>
				-->

				<div class="timeline">
					<div class="timeline-inner">
						<div class="frames" >
					
							{% for frame in serie.frames.all %}
								<div title="{{ frame.pin.title }}" class="frame {% for frame_page in frame.pin.page.all %}{{frame_page.slug}}{%if not forloop.last %}-{%endif%}{% endfor %} {{ frame.role }}">

									<!-- div class="counter">{{ forloop.counter }}</div -->
									<!-- a href="{% url admin:glue_frame_change frame.id %}" class="title" title="{{ frame.pin.title }}"> {{ frame.pin.title|truncatewords:3 }}</a -->
								</div>
								{{ frame.pin.title }}
							{% endfor %}
					
						</div>
					</div>
				</div>
				{% endfor %}
			</div>
		{% endif%}

	{% else %}

	<h2 style="text-align: center"><a href="{% url walt_login %}">&rarr; {% trans "please login to start your serie"%} &larr;</a></h2>
	{% endif %}
{% endblock %}



{% block page %}
	{% comment %}
	<div class="grid_12">	
		
		<h2>{% trans "series" %} ( {{ series.count }} )
			<div class="description">{% trans "last serie created" %} 
				{% if user.is_authenticated %}
					<a href="#" class="add-serie">{% trans "start a new serie" %}</a>
				{% else %}
					{% trans "in order to start a new serie, you need to be logged in" %} (<a href="{% url walt_login %}">{% trans "login" %}</a>)
				{% endif %}
			</div>
		</h2>

		<div class="series" style="border-bottom: 1px solid #ccc">
			
			{% for serie in series|slice:"3" %}
			<div class="serie change-serie" data-id="{{ serie.id }}" data-slug="{{ serie.slug }}" >
				<div class="title">{{ serie.title }}. <span><a href="{% url walt_serie serie.slug %}">play #{{ serie.id }}</a></span></div>

				<p class="authors">{% trans "created by" %}
					{% for u in serie.authors.all %}
						<a href="{% url walt_spiff u.username %}">{{ u.username }}</a>
						{% if not forloop.last %}, {% endif %}

					{% endfor %}
				<div class="frames" >
					&rarr;
					{% for frame in serie.frames.all %}
						<div class="frame {{ frame.role }}">
							<div class="counter">{{ forloop.counter }}</div>
							<a href="{% url admin:glue_frame_change frame.id %}" class="title" title="{{ frame.pin.title }}"> {{ frame.pin.title|truncatewords:3 }}</a>
						</div>
					{% endfor %}
					
				</div>
				
			</div>
			{% endfor %}
			
		</div>
		
	</div>
	
	{% endcomment %}


	<div class="grid_12">	
		
		<div class="grid_3 alpha">
			
			
			
			<div class="items">
				{% for pin in walt.wander.pins.all|slice:":10" %}
				<div class="item">
					
					<h3><a href="{% url walt_pin pin.slug %}"><!-- #{{ pin.id }} --> {{ pin.title }} </a></h3>
					<div class="metadata"><span class="date">{% if pin.date %}{{ pin.date }}{% else %}{{ pin.date_last_modified }}{% endif %}</span>
						{% for tag in pin.tags.all %}
							<a href="{% url walt_tag tag.type|lower tag.slug %}" class="tag" alt="{{ tag.name }} ( {{ tag.type }} )">{{ tag.name }}</a>
							{% if not forloop.last %},{%endif %} 
						{% endfor %}
						<span class="authors">
							&middot; {%trans "posted by" %}
							{% for u in pin.authors.all %}
								<a href="{% url walt_spiff u.username %}">{{ u.username }}</a>
								{% if not forloop.last %}, {% endif %}
							{% endfor %}
						</span>
						<span>
							<a href="#{% url admin:glue_pin_change pin.id %}" class="edit-pin" data-id="{{ pin.id }}">&rarr; {% trans "edit" %}</a>
							
						</span>
					</div>
					<blockquote>
						 {{ pin.abstract }}

					</blockquote>
					
					<a class="external" href="{{ pin.permalink}}">&rarr; {{ pin.permalink}}</a>

					{% for child in pin.children.all|slice:":10" %}
					<div class="comment">
						<a href="#" class="author"> </a> {{ child.abstract }}
					</div>
					{% endfor %}
					
				</div>
				{% endfor %}

			</div>
			&nbsp;

		</div>
		<div class="grid_3">
			
			
			<div class="items">
				{% for pin in walt.augment.pins %}
				<div class="item">
					
					<h3><a href="{% url walt_pin pin.slug %}"><!-- #{{ pin.id }} --> {{ pin.title }} </a></h3>
					<div class="metadata"><span class="date">{% if pin.date %}{{ pin.date }}{% else %}{{ pin.date_last_modified }}{% endif %}</span>
						{% for tag in pin.tags.all %}
							<a href="{% url walt_tag tag.type|lower tag.slug %}" class="tag" alt="{{ tag.name }} ( {{ tag.type }} )">{{ tag.name }}</a>
							{% if not forloop.last %},{%endif %} 
						{% endfor %}
						<span class="authors">
							&middot; {%trans "posted by" %}
							{% for u in pin.authors.all %}
								<a href="{% url walt_spiff u.username %}">{{ u.username }}</a>
								{% if not forloop.last %}, {% endif %}
							{% endfor %}
						</span>
						<span>
							<a href="#{% url admin:glue_pin_change pin.id %}" class="edit-pin" data-id="{{ pin.id }}">&rarr; {% trans "edit" %}</a>
						</span>
					</div>
					<blockquote>
						 {{ pin.abstract }}

					</blockquote>
					 {{ pin.content|safe }}
					<a class="external" href="{{ pin.permalink}}">&rarr; {{ pin.permalink}}</a>

					{% for child in pin.children.all|slice:":10" %}
					<div class="comment">
						<a href="#" class="author"> </a> {{ child.abstract }}
					</div>
					{% endfor %}
					
				</div>
				{% endfor %}

			</div>
			&nbsp;

		</div>
		<div class="grid_3">
			
			<div class="items">
				{% for pin in walt.learn.pins.all|slice:":10" %}
				
					{% ifequal pin.mimetype "text/x-bibtex" %}
						{% with bibtex=pin.bib %}
						<div class="item">
							<h4>{{ bibtex.author }}</h4>
							<h3><a href="{% url walt_pin pin.slug %}"><!-- #{{ pin.id  }}-->{{ bibtex.title }}</a></h3>
							<div class="metadata">
								<p>{{ bibtex.publisher }}, {{ bibtex.year }}</p>
								{% for tag in bibtex.keywords|split %}
									<a href="#" class="tag" alt="{{ tag }}">{{ tag }}</a>
									{% if not forloop.last %},{%endif %}
								{% endfor %}
								<span class="authors">
									&middot; {%trans "posted by" %}
									{% for u in pin.authors.all %}
										<a href="{% url walt_spiff u.username %}">{{ u.username }}</a>
										{% if not forloop.last %}, {% endif %}
									{% endfor %}
								</span>
								<span>
									<a href="#{% url admin:glue_pin_change pin.id %}" class="edit-pin" data-id="{{ pin.id }}">&rarr; {% trans "edit" %}</a>
									
								</span>
							</div>
							<blockquote>
								{% if bibtex.abstract %} {{ bibtex.abstract }} {% endif %}

								{{ pin.abstract }}
								
							</blockquote>

						</div>
						{% endwith %}
					{% endifequal %}
				
				{% endfor %}
				
			</div>
			&nbsp;
		</div>
		<div class="grid_3 omega">
			
			
			<div class="items">
				{% for pin in walt.try.pins.all|slice:":10" %}
				<div class="item">
					
					<h3><a href="{% url walt_pin pin.slug %}"><!-- #{{ pin.id }} -->{{ pin.title }} </a></h3>
					<div class="metadata"><span class="date">{% if pin.date %}{{ pin.date }}{% else %}{{ pin.date_last_modified }}{% endif %}</span>
						{% for tag in pin.tags.all %}
							<a href="{% url walt_tag tag.type|lower tag.slug %}" class="tag" alt="{{ tag.name }} ( {{ tag.type }} )">{{ tag.name }}</a>
							{% if not forloop.last %},{%endif %} 
						{% endfor %}
						<span class="authors">
							&middot; {%trans "posted by" %}
							{% for u in pin.authors.all %}
								<a href="{% url walt_spiff u.username %}">{{ u.username }}</a>
								{% if not forloop.last %}, {% endif %}
							{% endfor %}
						</span>
						<span>
							<a href="#{% url admin:glue_pin_change pin.id %}" class="edit-pin" data-id="{{ pin.id }}">&rarr; {% trans "edit" %}</a>
							
						</span>
					</div>
					<blockquote>
						 {{ pin.abstract }}

					</blockquote>
					 {{ pin.content|safe }}
					<a class="external" href="{{ pin.permalink}}">&rarr; {{ pin.permalink}}</a>

					{% for child in pin.children.all|slice:":10" %}
					<div class="comment">
						<a href="#" class="author"> </a> {{ child.abstract }}
					</div>
					{% endfor %}
					
				</div>
				{% endfor %}
				
			</div>
		</div>
	</div>
{% endblock %}