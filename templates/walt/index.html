{% extends "walt/middle.html" %}
{% load i18n %}
{% load extras %}
{% block spiffing %}{% if spiff %} {{ spiff }}'s {% endif %}{% endblock %}


{% block urls %}
	{{ block.super }}
	oo.urls.get_serie = "{% url glue_api_serie_frames 0 %}";
	oo.urls.list_serie = "{% url glue_api_series %}";
	oo.urls.remove_serie = "{% url glue_api_serie 0 %}";
	oo.urls.add_serie = "{% url glue_api_series %}";
    oo.urls.edit_serie = "{% url glue_api_serie 0 %}";
{% endblock %}

{% block navbar %}
	<div class="grid_12" >
				
		<h2 class="grid_3 alpha">
				<a href="{% if spiff %}{% url walt_w_spiff spiff %}{% else %}{% url walt_w %}{% endif %}">{% if spiff %} his/her {% endif %} {{ walt.wander.page.title }}
					( {{ walt.wander.pins.count }} )
				</a>
				<a href="#add-walt-w-modal" role="button" class="btn" data-toggle="modal">{% trans "add item" %}</a>
				<div class="description">
					
				
					{{ walt.wander.page.abstract }}
				</div>
			</h2>
		<h2 class="grid_3">
			<a href="{% if spiff %}{% url walt_a_spiff spiff %}{% else %}{% url walt_a %}{% endif %}">{% if spiff %} his/her {% endif %}  {{ walt.augment.page.title }}
				( {{ walt.augment.pins.count }} )
			</a>
				<div class="description">
					{{ walt.augment.page.abstract }} 
				</div>
		</h2>
		<h2 class="grid_3" >
			<a href="{% if spiff %}{% url walt_l_spiff spiff %}{% else %}{% url walt_l %}{% endif %}">{% if spiff %} his/her {% endif %}  {{ walt.learn.page.title }}
				 ( {{ walt.learn.pins.count }} )
			</a>
			<div class="description">
				{{ walt.learn.page.abstract }}
			</div>
		</h2>
		<h2 class="grid_3 omega">
			<a href="{% if spiff %}{% url walt_t_spiff spiff %}{% else %}{% url walt_t %}{% endif %}">{% if spiff %} his/her {% endif %}  {{ walt.try.page.title }}
				( {{ walt.try.pins.count }} )
			</a>
			<div class="description">
				{{ walt.try.page.abstract }}
			</div>
		</h2>
	</div>

	<div class="grid_12 shadow" >
		<div class="grid_3 alpha">&nbsp;</div>
		<div class="grid_3">&nbsp;</div>
		<div class="grid_3">&nbsp;</div>
		<div class="grid_3 omega">&nbsp;</div>
	</div>
{% endblock %}


{% block footer %}
	{% if user.is_authenticated %}
		<div class="grid_2 alpha">
			<h2><a href="#" class="add-serie">{% trans "start a new serie" %}</a>
			</h2>
		</div>
			
		{% if workon_serie %}
			<div class="grid_10 omega">
				<!-- last serie aka workon, if any -->
				<h2>
				{% for serie in workon_serie %}
					<a href="{% url walt_serie serie.slug %}">{{ serie.title }}</a> ( {{ serie.type }} )
				{% endfor %}
				</h2>
				
				<!-- serie authors 
				<p class="authors">{% trans "created by" %}
							{% for u in serie.authors.all %}
								<a href="{% url walt_spiff u.username %}">{{ u.username }}</a>
								{% if not forloop.last %}, {% endif %}

							{% endfor %}
				</p>
				-->

				<div class="timeline">
					<div class="timeline-inner">
						<div class="frames" >
						&rarr;
							{% for frame in serie.frames.all %}
								<div class="frame {{ frame.role }}">
									<!-- div class="counter">{{ forloop.counter }}</div -->
									<!-- a href="{% url admin:glue_frame_change frame.id %}" class="title" title="{{ frame.pin.title }}"> {{ frame.pin.title|truncatewords:3 }}</a -->
								</div>
							{% endfor %}
					
						</div>
					</div>
				</div>
			</div>
		{% endif%}

	{% else %}

	<h2 style="text-align: center"><a href="{% url walt_login %}">&rarr; {% trans "please login to start your serie"%} &larr;</a></h2>
	{% endif %}
{% endblock %}



{% block page %}
	{% comment %}
	<div class="grid_12">	
		
		<h2>{% trans "series" %} ( {{ series.count }} )
			<div class="description">{% trans "last serie created" %} 
				{% if user.is_authenticated %}
					<a href="#" class="add-serie">{% trans "start a new serie" %}</a>
				{% else %}
					{% trans "in order to start a new serie, you need to be logged in" %} (<a href="{% url walt_login %}">{% trans "login" %}</a>)
				{% endif %}
			</div>
		</h2>

		<div class="series" style="border-bottom: 1px solid #ccc">
			
			{% for serie in series|slice:"3" %}
			<div class="serie change-serie" data-id="{{ serie.id }}" data-slug="{{ serie.slug }}" >
				<div class="title">{{ serie.title }}. <span><a href="{% url walt_serie serie.slug %}">play #{{ serie.id }}</a></span></div>

				<p class="authors">{% trans "created by" %}
					{% for u in serie.authors.all %}
						<a href="{% url walt_spiff u.username %}">{{ u.username }}</a>
						{% if not forloop.last %}, {% endif %}

					{% endfor %}
				<div class="frames" >
					&rarr;
					{% for frame in serie.frames.all %}
						<div class="frame {{ frame.role }}">
							<div class="counter">{{ forloop.counter }}</div>
							<a href="{% url admin:glue_frame_change frame.id %}" class="title" title="{{ frame.pin.title }}"> {{ frame.pin.title|truncatewords:3 }}</a>
						</div>
					{% endfor %}
					
				</div>
				
			</div>
			{% endfor %}
			
		</div>
		
	</div>
	
	{% endcomment %}


	<div class="grid_12">	
		
		<div class="grid_3 alpha">
			
			
			
			<div class="items">
				{% for pin in walt.wander.pins.all|slice:":10" %}
				<div class="item">
					
					<h3><a href="{% url walt_pin pin.slug %}"><!-- #{{ pin.id }} --> {{ pin.title }} </a></h3>
					<div class="metadata"><span class="date">{% if pin.date %}{{ pin.date }}{% else %}{{ pin.date_last_modified }}{% endif %}</span>
						{% for tag in pin.tags.all %}
							<a href="{% url walt_tag tag.type|lower tag.slug %}" class="tag" alt="{{ tag.name }} ( {{ tag.type }} )">{{ tag.name }}</a>
							{% if not forloop.last %},{%endif %} 
						{% endfor %}
						<p class="authors">
							{%trans "posted by" %}
							{% for u in pin.authors.all %}
								<a href="{% url walt_spiff u.username %}">{{ u.username }}</a>
								{% if not forloop.last %}, {% endif %}
							{% endfor %}
						</p>
						<p>
							<a href="{% url admin:glue_pin_change pin.id %}">&rarr; {% trans "edit" %}</a>
							<ul>
							<li style="float:left" class="drag-to-serie draggable" data-slug="{{ pin.slug }}" data-mimetype="{{ pin.mimetype }}" data-id="{{ pin.id }}">{% trans "drag" %}</li>
							</ul>
						</p>
					</div>
					<blockquote>
						 {{ pin.abstract }}

					</blockquote>
					
					<a class="external" href="{{ pin.permalink}}">&rarr; {{ pin.permalink}}</a>

					{% for child in pin.children.all|slice:":10" %}
					<div class="comment">
						<a href="#" class="author"> </a> {{ child.abstract }}
					</div>
					{% endfor %}
					
				</div>
				{% endfor %}

			</div>
			

		</div>
		<div class="grid_3">
			
			
			<div class="items">
				{% for pin in walt.augment.pins %}
				<div class="item">
					
					<h3><a href="{% url walt_pin pin.slug %}"><!-- #{{ pin.id }} --> {{ pin.title }} </a></h3>
					<div class="metadata"><span class="date">{% if pin.date %}{{ pin.date }}{% else %}{{ pin.date_last_modified }}{% endif %}</span>
						{% for tag in pin.tags.all %}
							<a href="{% url walt_tag tag.type|lower tag.slug %}" class="tag" alt="{{ tag.name }} ( {{ tag.type }} )">{{ tag.name }}</a>
							{% if not forloop.last %},{%endif %} 
						{% endfor %}
						<p class="authors">
							{%trans "posted by" %}
							{% for u in pin.authors.all %}
								<a href="{% url walt_spiff u.username %}">{{ u.username }}</a>
								{% if not forloop.last %}, {% endif %}
							{% endfor %}
						</p>
						<p>
							<a href="{% url admin:glue_pin_change pin.id %}">&rarr; {% trans "edit" %}</a>,
							<a href="#" class="drag-to-serie" data-slug="{{ pin.slug }}" data-mimetype="{{ pin.mimetype }}" data-id="{{ pin.id }}">{% trans "add to serie" %}</a>
						</p>
					</div>
					<blockquote>
						 {{ pin.abstract }}

					</blockquote>
					 {{ pin.content|safe }}
					<a class="external" href="{{ pin.permalink}}">&rarr; {{ pin.permalink}}</a>

					{% for child in pin.children.all|slice:":10" %}
					<div class="comment">
						<a href="#" class="author"> </a> {{ child.abstract }}
					</div>
					{% endfor %}
					
				</div>
				{% endfor %}

			</div>
			

		</div>
		<div class="grid_3">
			
			<div class="items">
				{% for pin in walt.learn.pins.all|slice:":10" %}
				
					{% ifequal pin.mimetype "text/x-bibtex" %}
						{% with bibtex=pin.bib %}
						<div class="item">
							<h4>{{ bibtex.author }}</h4>
							<h3><a href="{% url walt_pin pin.slug %}"><!-- #{{ pin.id  }}-->{{ bibtex.title }}</a></h3>
							<div class="metadata">
								<p>{{ bibtex.publisher }}, {{ bibtex.year }}</p>
								{% for tag in bibtex.keywords|split %}
									<a href="#" class="tag" alt="{{ tag }}">{{ tag }}</a>
									{% if not forloop.last %},{%endif %}
								{% endfor %}
								<p class="authors">
									{%trans "posted by" %}
									{% for u in pin.authors.all %}
										<a href="{% url walt_spiff u.username %}">{{ u.username }}</a>
										{% if not forloop.last %}, {% endif %}
									{% endfor %}
								</p>
								<p><a href="{% url admin:glue_pin_change pin.id %}">&rarr; {% trans "edit" %}</a>,
							<a href="#" class="drag-to-serie" data-slug="{{ pin.slug }}" data-mimetype="{{ pin.mimetype }}" data-id="{{ pin.id }}">{% trans "add to serie" %}</a></p>
							</div>
							<blockquote>
								{% if bibtex.abstract %} {{ bibtex.abstract }} {% endif %}

								{{ pin.abstract }}
								
							</blockquote>

						</div>
						{% endwith %}
					{% endifequal %}
				
				{% endfor %}
				
			</div>
		</div>
		<div class="grid_3 omega">
			
			
			<div class="items">
				{% for pin in walt.try.pins.all|slice:":10" %}
				<div class="item">
					
					<h3><a href="{% url walt_pin pin.slug %}"><!-- #{{ pin.id }} -->{{ pin.title }} </a></h3>
					<div class="metadata"><span class="date">{% if pin.date %}{{ pin.date }}{% else %}{{ pin.date_last_modified }}{% endif %}</span>
						{% for tag in pin.tags.all %}
							<a href="{% url walt_tag tag.type|lower tag.slug %}" class="tag" alt="{{ tag.name }} ( {{ tag.type }} )">{{ tag.name }}</a>
							{% if not forloop.last %},{%endif %} 
						{% endfor %}
						<p class="authors">
							{%trans "posted by" %}
							{% for u in pin.authors.all %}
								<a href="{% url walt_spiff u.username %}">{{ u.username }}</a>
								{% if not forloop.last %}, {% endif %}
							{% endfor %}
						</p>
						<p><a href="{% url admin:glue_pin_change pin.id %}">&rarr; {% trans "edit" %}</a>,
							<a href="#" class="drag-to-serie" data-slug="{{ pin.slug }}" data-mimetype="{{ pin.mimetype }}" data-id="{{ pin.id }}">{% trans "add to serie" %}</a></p>
					</div>
					<blockquote>
						 {{ pin.abstract }}

					</blockquote>
					 {{ pin.content|safe }}
					<a class="external" href="{{ pin.permalink}}">&rarr; {{ pin.permalink}}</a>

					{% for child in pin.children.all|slice:":10" %}
					<div class="comment">
						<a href="#" class="author"> </a> {{ child.abstract }}
					</div>
					{% endfor %}
					
				</div>
				{% endfor %}
				
			</div>
		</div>
	</div>
{% endblock %}