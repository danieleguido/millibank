{% extends "walt/middle.html" %}
{% load i18n %}
{% load extras %}


{% block navbar %}
	<div class="grid_12" >
				
		<h2 class="grid_6 alpha">
			<a href="#">{{ page.title }} ( {{ pins.count }} )</a>
			{% if user.is_authenticated %}
				| <a href="#add-walt-{{ page.slug|slice:":1" }}-modal" role="button" data-toggle="modal">+ {% trans "add bookmark" %}</a>
			{% endif %}

		</h2>

		<h2 class="grid_6 omega crimson">
			{% trans "series using" %} {{ page.title }} ( {{ series.count }} )
		</h2>
	</div>
	<div class="grid_12 shadow" >
		<div class="grid_6 alpha">&nbsp;</div>
		<div class="grid_6 omega crimson">&nbsp;</div>
	</div>
{% endblock %}

{% block page %}

	<div class="grid_12">
		<div class="grid_6 alpha">
			

			<div class="items">
				{% for pin in page.pins.all|slice:":10" %}
					{% ifequal pin.mimetype "text/x-bibtex" %}
						{% with bibtex=pin.bib %}
						<div class="item">
							<h4>{{ bibtex.author }}</h4>
							<h3>{{ bibtex.title }}</h3>
							<div class="metadata">
								<p>{{ bibtex.publisher }}, {{ bibtex.year }}</p>
								{% for tag in bibtex.keywords|split %}
									<a href="#" class="tag" alt="{{ tag }}">{{ tag }}</a>
									{% if not forloop.last %},{%endif %}
								{% endfor %}
								<p><a href="{% url admin:glue_pin_change pin.id %}">&rarr; {% trans "edit" %}</a></p>
							</div>
							<blockquote>
								{% if bibtex.abstract %}<p> {{ bibtex.abstract }} </p>{% endif %}

								{{ pin.abstract }}
								
							</blockquote>

						</div>
						{% endwith %}
					{% else %}
						<div class="item">
					
					<h3><a href="{% url walt_pin pin.slug %}"><!-- #{{ pin.id }} --> {{ pin.title }} </a></h3>
					<div class="metadata"><span class="date">{% if pin.date %}{{ pin.date }}{% else %}{{ pin.date_last_modified }}{% endif %}</span>
						{% for tag in pin.tags.all %}
							<a href="{% url walt_tag tag.type|lower tag.slug %}" class="tag" alt="{{ tag.name }} ( {{ tag.type }} )">{{ tag.name }}</a>
							{% if not forloop.last %},{%endif %} 
						{% endfor %}
						
						
					</div>
					<blockquote>
						 {{ pin.abstract }}
					</blockquote>
					<div class="content">
						 {{ pin.content|safe }}
					</div>

					{% with authors=pin.authors.all %}

					<span class="authors">
						{%trans "posted by" %}
						{% for u in authors %}
							<a href="{% url walt_spiff u.username %}">{{ u.username }}</a>
							{% if not forloop.last %}, {% endif %}
						{% endfor %}
					</span>

					<div class="actions">
						<a href="#{% url admin:glue_pin_change pin.id %}" class="edit-pin action" data-id="{{ pin.id }}" title="{% trans "edit" %}">{% trans "edit" %}</a>
						
						{% if pin.permalink %}
						<a class="external action" href="{{ pin.permalink}}">{% trans "link" %}</a>
						{% endif %}

						{% if workon_serie  %}
						<a href="#{% url admin:glue_pin_change pin.id %}"
							class="append-frame action" data-slug="{{ pin.slug }}" data-title="{{ pin.title }}" data-page-slug="wander" data-id="{{ pin.id }}" >{% trans "use in serie" %}</a>
						{% endif %}

						{% if user in authors %}
							<a class="remove-pin action warning" data-id="{{ pin.id }}">{% trans "delete" %}</a>
						{% endif %}
					</div>

					{% endwith %}

					

					{% for child in pin.children.all|slice:":10" %}
					<div class="comment">
						<a href="#" class="author"> </a> {{ child.abstract }}
					</div>
					{% endfor %}
					
				</div>

					{% endifequal %}
				{% endfor %}

			</div>
		</div>
		<div class="grid_6 omega">
			<div class="items">
				{% for serie in series %}
					<div class="item serie">
						<h3><a href="{% url walt_serie serie.slug %}">{{ serie.title }}</a></h3>
						<div class="abstract">
							{{ serie.abstract }}
						</div>
						<a href="{% url walt_serie_stack serie.slug %}">{% trans "view as stack" %}</a>

						{% for frame in serie.frames.all %}
						<div>{{frame.pin.id}}</div>
						{% endfor %}
					</div>
				{% endfor %}
			</div>
		</div>

	</div>
{% endblock %}